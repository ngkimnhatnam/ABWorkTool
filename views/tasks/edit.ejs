<%- include("../partials/header", {date: date}) %>

<div class="container">
	<div class="row">
		<div style="width: 30%; margin: 25px auto;">
			<h1 style="text-align: center">Edit this task </h1>
			<form action="/task/<%=task._id%>?_method=PUT" method="POST">
				<div class="form-group">
					<input class="form-control" type="date" name="date" value="<%=task.date%>" min="<%=thisMoment%>">
				</div>
				<div class="form-group">
					<div class="input-group mb-3">
					  <div class="input-group-prepend">
						<label class="input-group-text" for="inputGroupSelect01">Worker</label>
					</div>
					<select class="custom-select" id="inputGroupSelect01" name="user">
						<option value="<%=task.user.id%>" selected><%=task.user.nickname%></option>
						
						<% users.forEach(function(user){ %>
						<% console.log("list of users "+ user); %>
							<% if(user._id.toString() !== task.user.id.toString()){ %>
								<option value="<%=user._id%>"><%=user.nickname%></option>
							<% } %>
						<% }) %>
					  </select>
					</div>
				</div>
				<div class="form-group">
					<div class="input-group">
						<% task.unit.forEach(function(name){ %>						
							<input type="checkbox" id="chooseUnit" name="unit" value="<%=name%>" checked>
						<label for="chooseUnit"><%=name%></label>
						<% }) %>
						<% for(var i=0;i<units.length;i++){ %>
							<% for(var y=0;y<task.unit.length;y++){ %>
								<%if(units[i].name === task.unit[y]){ %>
									<% units.splice(i,1); %>
								<% } %>
							<% } %>					  			
						<% } %>	
						<% units.forEach(function(unit){ %>
							<input type="checkbox" id="chooseUnit" name="unit" value="<%=unit.name%>">
								<label for="chooseUnit"><%=unit.name%></label>
						<% }) %>
					</div>
				</div>
				<div class="form-group">
					<input class="form-control" type="text" name="sidenote" placeholder="Add sidenote here">
				</div>
				<div class="form-group">
					<button class="btn btn-lg btn-primary btn-block">
						Update
					</button>
				</div>
		</form>
			<a href="/task">Back to tasks</a>
		</div>
	</div>
</div>

<%- include("../partials/footer") %>